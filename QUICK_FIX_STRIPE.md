# ‚ö° –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Stripe –Ω–∞ Netlify

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
Netlify —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –≤–∏–¥—è—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `STRIPE_SECRET_KEY`

## ‚úÖ –†–µ—à–µ–Ω–∏–µ –∑–∞ 5 –º–∏–Ω—É—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Netlify UI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Netlify:**
   - –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://app.netlify.com
   - –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Site Configuration** ‚Üí **Environment Variables**

2. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
   ```
   –ò–º—è: STRIPE_SECRET_KEY
   –ó–Ω–∞—á–µ–Ω–∏–µ: sk_test_–≤–∞—à_–∫–ª—é—á (–∏–∑ Stripe Dashboard)
   Scope: Production, Deploy Previews, Branch Deploys (–≤—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ)
   
   –ò–º—è: VITE_STRIPE_PUBLISHABLE_KEY  
   –ó–Ω–∞—á–µ–Ω–∏–µ: pk_test_–≤–∞—à_–∫–ª—é—á (–∏–∑ Stripe Dashboard)
   Scope: Production, Deploy Previews, Branch Deploys (–≤—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ)
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π:**
   - **Deploys** ‚Üí **Trigger deploy** ‚Üí **Clear cache and deploy site**
   - ‚ö†Ô∏è –í–∞–∂–Ω–æ: –°—Ç–∞—Ä—ã–µ –¥–µ–ø–ª–æ–∏ –Ω–µ –ø–æ–ª—É—á–∞—Ç –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ!

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç–∫—Ä–æ–π—Ç–µ: `https://–≤–∞—à-—Å–∞–π—Ç.netlify.app/.netlify/functions/test-env`
   - –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å `"hasSecretKey": true` –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å –∫–ª—é—á–∞

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Netlify CLI (–¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö)

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Netlify CLI (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
npm install -g netlify-cli

# 2. –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
netlify login

# 3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /Users/pavelbekoev/landing_estimator

# 4. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
netlify env:set STRIPE_SECRET_KEY "sk_test_–≤–∞—à_–∫–ª—é—á"
netlify env:set VITE_STRIPE_PUBLISHABLE_KEY "pk_test_–≤–∞—à_–∫–ª—é—á"

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–±–∞–≤–∏–ª–∏—Å—å
./check-netlify-env.sh

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π
git commit --allow-empty -m "Trigger rebuild for env vars"
git push
```

## üîç –ì–¥–µ –≤–∑—è—Ç—å –∫–ª—é—á–∏ Stripe?

1. –ó–∞–π–¥–∏—Ç–µ –≤ [Stripe Dashboard](https://dashboard.stripe.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Developers** ‚Üí **API keys**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Secret key** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk_test_...`) ‚Üí –¥–ª—è `STRIPE_SECRET_KEY`
   - **Publishable key** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `pk_test_...`) ‚Üí –¥–ª—è `VITE_STRIPE_PUBLISHABLE_KEY`

## üêõ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
```bash
curl https://–≤–∞—à-—Å–∞–π—Ç.netlify.app/.netlify/functions/test-env
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```json
{
  "stripe": {
    "hasSecretKey": true,
    "secretKeyPrefix": "sk_test_51...",
    "secretKeyLength": 107
  },
  "stripeEnvKeys": ["STRIPE_SECRET_KEY"]
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –õ–æ–≥–∏ –≤ Netlify

1. –ó–∞–π–¥–∏—Ç–µ –≤ Netlify UI
2. **Functions** ‚Üí `create-payment-intent`
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
4. –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   ```
   üîë Environment check: {
     hasStripeKey: true,
     keyPrefix: "sk_test_51...",
     keyType: "TEST",
     ...
   }
   ```

## ‚ùå –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞ 1: `"hasSecretKey": false`
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —á–µ—Ä–µ–∑ UI –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π

### –û—à–∏–±–∫–∞ 2: `keyType: "INVALID"`
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞ (–Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk_test_` –∏–ª–∏ `sk_live_`)  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ **Secret key**, –∞ –Ω–µ Publishable key

### –û—à–∏–±–∫–∞ 3: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã, –Ω–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –∑–∞–ø—É—â–µ–Ω –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π  
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –Ω–æ–≤—ã–º –¥–µ–ø–ª–æ—è–º. –ó–∞–ø—É—Å—Ç–∏—Ç–µ "Clear cache and deploy site"

### –û—à–∏–±–∫–∞ 4: –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ `allEnvKeys: []`
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Production/Preview)  
**–†–µ—à–µ–Ω–∏–µ:** –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Scopes)

## üßπ –ü–æ—Å–ª–µ –æ—Ç–ª–∞–¥–∫–∏

–ö–æ–≥–¥–∞ –≤—Å–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç, —É–¥–∞–ª–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é:
```bash
rm netlify/functions/test-env.js
git add netlify/functions/test-env.js
git commit -m "Remove test env function"
git push
```

## üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–º. —Ñ–∞–π–ª: **NETLIFY_ENV_DEBUG.md**

---

**–í–æ–ø—Ä–æ—Å—ã?** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ Netlify UI ‚Üí Functions ‚Üí create-payment-intent

